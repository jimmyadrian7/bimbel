<html>
    
    <head>
        {% include "/Report/View/partial/style.twig" %}

        <style>
            .wrapper-page {
                page-break-after: always;
                position: relative;
            }

            .wrapper-page:last-child {
                page-break-after: avoid;
            }

            header {
                position: fixed;
                top: 0px;
                left: 0;
                right: 0;
                height: 200px;
            }

            body {
                margin-top: 210px;
            }

            #background {
                background-image:url({{background}});
                display: block;
                position: fixed;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: -1000;
                background-repeat: repeat;
            }
        </style>
    </head>

    <body>
        <div id="background"></div>

        {% for kursus, d in data %}
            {% for jenis, d1 in d %}

                <div class="wrapper-page">
                    <header>
                        <div class="container">
                            {% include 
                                "Report/View/partial/header.twig" 
                                with {
                                    'additional': [
                                        {'value': kursus, 'label': 'Kursus'},
                                        {'value': jenis_pembayaran_list[jenis], 'label': 'Jenis Pembayaran'}
                                    ] 
                                } 
                            %}
                        </div>
                    </header>

                    <main>
                        <div class="container">
                            <div class="content">
                                <div class="mb-10">
                                    <span class="table-title">Pendapatan Guru</span>
                                </div>
                                <table class="table-content">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Nama Siswa</th>
                                            <th>Kode Tagihan</th>
                                            <th>Tanggal Tagihan</th>
                                            <th>Tanggal Lunas</th>
                                            <th>Nama Item</th>
                                            <th>Harga Total</th>
                                            <th>% Komisi</th>
                                            <th>Komisi</th>
                                        </tr>
                                    </thead>
                                    
                                    <tbody>
                                        {% set total = 0 %}
                                        {% for tagihan_detail in d1 %}
                                            {% set total = total + tagihan_detail.komisi %}
                                            <tr>
                                                <td>{{ loop.index }}</td>
                                                <td>{{ tagihan_detail.nama_siswa }}</td>
                                                <td>{{ tagihan_detail.kode_tagihan }}</td>
                                                <td>{{ tagihan_detail.tanggal_tagihan|date("d/m/Y") }}</td>
                                                <td>{{ tagihan_detail.tanggal_lunas|date("d/m/Y") }}</td>
                                                <td>{{ tagihan_detail.nama_item }}</td>
                                                <td>{{ tagihan_detail.harga_total|number_format(0, ',', '.') }}</td>
                                                <td>{{ tagihan_detail.persen_komisi }}%</td>
                                                <td>{{ tagihan_detail.komisi|number_format(0, ',', '.') }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>

                                    <tr class="bold">
                                        <td class="bg-transparent" colspan="7"></td>
                                        <td class="bg-red">Total Pendapatan</td>
                                        <td class="bg-red">{{ total|number_format(0, ',', '.') }}</td>
                                    </tr>

                                    {% if loop.parent.loop.last and loop.last %}
                                    <tr class="bold">
                                        <td class="bg-transparent" colspan="7"></td>
                                        <td class="bg-red">Total Semua Pendapatan</td>
                                        <td class="bg-red">{{ total_pendapatan|number_format(0, ',', '.') }}</td>
                                    </tr>
                                    {% endif %}
                                </table>
                            </div>
                        </div>
                    </main>
                </div>
                
            {% endfor %}
        {% endfor %}
    </body>
</html>